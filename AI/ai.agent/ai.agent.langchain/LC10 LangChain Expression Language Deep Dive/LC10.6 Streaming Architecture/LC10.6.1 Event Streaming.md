| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC10.6.1.1 The Event Stream Protocol**       | Concept                                 | The concept of 'events' vs 'chunks' in a chain                                | Events describe 'what happened'; chunks describe 'what data'.   |
| **LC10.6.1.2 Standard Event Types**            | Taxonomy                                | on_chain_start, on_chat_model_start, on_chat_model_stream, on_chain_end       | Learn the 4 lifecycle events of every Runnable.                 |
| **LC10.6.1.3 The V2 API (astream_events)**     | Modern usage                            | using .astream_events() instead of callbacks handles                          | astream_events enables standard async for loops for events.     |
| **LC10.6.1.4 Filtering Events**                | Noise reduction                         | include_names, include_types, exclude tags patterns                           | Filter events to only see the ones you care about.              |
| **LC10.6.1.5 Visualization**                   | Mental Model                            | Mapping the chain graph to the event timeline                                 | Events are the heartbeat of the chain's execution graph.        |
| **LC10.6.1.6 Stream Events vs Callbacks**      | Comparison                              | astream_events is the newer, async-native replacement for callbacks           | Prefer astream_events over callbacks for async apps.            |

# Event Streaming: The Heartbeat of Execution

When you call `invoke()`, you wait.
When you call `stream()`, you get the *final output token by token*.
But what if you want to know when the **retriever** starts? Or when the **tool** finishes? Or getting intermediate steps?

That is **Event Streaming**.

---

## 1. The V2 API (astream_events)

This is the standard way to watch a chain run in real-time.

```python
async for event in chain.astream_events(inputs, version="v2"):
    kind = event["event"]
    name = event["name"]
    data = event["data"]
    
    if kind == "on_chat_model_stream":
        print(f"Token: {data['chunk'].content}")
    elif kind == "on_tool_start":
        print(f"Tool {name} started with input: {data['input']}")
```

This async iterator gives you X-Ray vision into the chain.

---

## 2. Standard Event Types

Every Runnable emits these lifecycle events:

1.  **on_chain_start**: "I have begun." (Contains Inputs)
2.  **on_chain_stream**: "I produced a chunk." (For streaming runnables)
3.  **on_chain_end**: "I have finished." (Contains Outputs)
4.  **on_chain_error**: "I failed." (Contains Exception)

Specific components add specific flavors:
*   `on_chat_model_start`
*   `on_retriever_start`
*   `on_tool_start`

---

## 3. Filtering Events (Noise Reduction)

A complex chain emits thousands of events. Filter them!

```python
# Only show events from the LLM and the 'my_tool' node
stream = chain.astream_events(
    inputs, 
    version="v2",
    include_names=["ChatOpenAI", "my_tool"]
)
```

Use `include_types=["llm"]` to catch all LLMs regardless of name.

---

## 4. Visualization

Imagine a timeline.

```
Time 0.0s: [on_chain_start] (Root Chain)
Time 0.1s:   [on_retriever_start] (Retriever)
Time 0.5s:   [on_retriever_end] (Retriever) -> Docs found
Time 0.6s:   [on_chat_model_start] (LLM)
Time 0.7s:     [on_chat_model_stream] "P"
Time 0.8s:     [on_chat_model_stream] "ar"
Time 0.9s:     [on_chat_model_stream] "is"
...
Time 1.5s:   [on_chat_model_end] (LLM)
Time 1.6s: [on_chain_end] (Root Chain)
```

`astream_events` flattens this nested tree into a linear stream of dictionaries.

---

## Quick Reference

| Method | Syntax |
|--------|--------|
| **Stream** | `chain.astream_events(x, version="v2")` |
| **Filter (Name)** | `include_names=["NodeName"]` |
| **Filter (Type)** | `include_types=["llm", "tool"]` |
| **Output** | Dict with `event`, `name`, `data`, `tags` |
