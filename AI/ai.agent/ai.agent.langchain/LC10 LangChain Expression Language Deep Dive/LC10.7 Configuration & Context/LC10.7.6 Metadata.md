| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC10.7.6.1 The Metadata Dict**               | Structure                               | Key-Value pairs passed in config                                              | Metadata is a KV store for run context.                         |
| **LC10.7.6.2 Session Tracking**                | Application                             | conversation_id, user_id, org_id                                              | Always include conversation_id and user_id in metadata.         |
| **LC10.7.6.3 Accessing Metadata**              | Retrieval                               | config['metadata'] inside tools and lambdas                                   | Read metadata inside your code to make decisions.               |
| **LC10.7.6.4 Metadata vs Tags**                | Distinction                             | Tags = List[str] (Categorical); Metadata = Dict (Structured)                  | Use tags for categories; metadata for specific values.          |
| **LC10.7.6.5 Privacy & PII**                   | Safety                                  | Warning about putting sensitive data in metadata (logs)                       | Don't put PII (passwords, emails) in metadata; it gets logged.  |

# Metadata: Contextual Data

Tags are labels ("Blue", "Red"). Metadata is data (`{"color": "Blue", "saturdation": 0.5}`).

---

## 1. Session Tracking (The Big Use Case)

Every `invoke` should carry context about WHO is calling it.

```python
config = {
    "metadata": {
        "user_id": "u-999",
        "conversation_id": "c-123",
        "environment": "production"
    }
}
chain.invoke("Hi", config=config)
```

In LangSmith, this allows you to see "All conversations by User u-999".

---

## 2. Accessing Metadata in Logic

You can change logic based on metadata!

```python
def check_permissions(x, config):
    user_id = config.get("metadata", {}).get("user_id")
    if is_admin(user_id):
        return x
    raise PermissionError("Access Denied")

chain = RunnableLambda(check_permissions) | sensitive_tool
```

---

## 3. Metadata vs Tags

*   **Tags**: `["mobile_user"]` (Good for filtering: "Show me mobile users").
*   **Metadata**: `{"device": "iPhone 14"}` (Good for detail: "What specific device?").

---

## Quick Reference

| Field | Usage |
|-------|-------|
| **user_id** | Who? |
| **conversation_id** | Which chat? |
| **source** | Where from? (Slack, Web) |
| **Log Safety** | **No PII** (GDPR risk) |
