| **Subtopic** | **Focus** | **Key Concepts** | **One-Line Recall** |
|---|---|---|---|
| **LC12.2.6.1 Onboarding Automation** | Process | Automated tenant setup | Script tenant creation process. |
| **LC12.2.6.2 Database Setup** | Infrastructure | Creating tenant databases | Provision DB resources automatically. |
| **LC12.2.6.3 Vector Store Init** | Data | Initialize tenant collections | Create tenant vector collections. |
| **LC12.2.6.4 Default Configuration** | Settings | Initial tenant settings | Set up default configs. |
| **LC12.2.6.5 Lifecycle Management** | Operations | Activate, suspend, delete | Manage tenant lifecycle. |

# Tenant Provisioning: Automated Onboarding

Automating tenant setup and lifecycle managementdirectory.

---

## 1. Automated Provisioning

```python
class TenantProvision:
    async def provision_new_tenant(self, tenant_data: dict) -> dict:
        tenant_id = generate_tenant_id()
        
        try:
            # 1. Create database resources
            await self.setup_database(tenant_id)
            
            # 2. Initialize vector store
            await self.setup_vector_store(tenant_id)
            
            # 3. Create default configuration
            await self.create_config(tenant_id, tenant_data)
            
            # 4. Setup authentication
            await self.setup_auth(tenant_id, tenant_data)
            
            # 5. Activate tenant
            await self.activate_tenant(tenant_id)
            
            return {"tenant_id": tenant_id, "status": "active"}
            
        except Exception as e:
            # Rollback
            await self.cleanup_tenant(tenant_id)
            raise
```

---

## 2. Database Provisioning

```python
async def setup_database(self, tenant_id: str):
    # Option 1: Create schema
    await db.execute(f"CREATE SCHEMA IF NOT EXISTS {tenant_id}")
    await db.execute(f"""
        CREATE TABLE {tenant_id}.conversations (
            id UUID PRIMARY KEY,
            created_at TIMESTAMP,
            messages JSONB
        )
    """)
    
    # Option 2: Create separate database
    # await admin_db.execute(f"CREATE DATABASE {tenant_id}_db")
```

---

## 3. Vector Store Initialization

```python
async def setup_vector_store(self, tenant_id: str):
    # Create tenant-specific collection
    collection = chroma_client.create_collection(
        name=f"tenant_{tenant_id}",
        metadata={"tenant_id": tenant_id}
    )
    
    # Or use shared collection with tenant filter ensured
    # (collection already exists, just verify access)
    pass
```

---

## 4. Default Configuration

```python
async def create_config(self, tenant_id: str, tenant_data: dict):
    config = TenantConfig(
        tenant_id=tenant_id,
        name=tenant_data["name"],
        model="gpt-4o-mini",  # Default
        max_tokens=1000,
        rate_limit_per_minute=60,
        features={"basic_chat": True},
        plan="trial",
        created_at=datetime.now()
    )
    
    await config_service.save(config)
```

---

## 5. Tenant Lifecycle

```python
class TenantLifecycle:
    async def activate(self, tenant_id: str):
        await db.execute(
            "UPDATE tenants SET status = 'active', activated_at = NOW() WHERE id = %s",
            (tenant_id,)
        )
    
    async def suspend(self, tenant_id: str, reason: str):
        await db.execute(
            "UPDATE tenants SET status = 'suspended', suspended_at = NOW(), suspend_reason = %s WHERE id = %s",
            (reason, tenant_id)
        )
        # Optionally: disable API access
    
    async def delete(self, tenant_id: str):
        # Soft delete
        await db.execute(
            "UPDATE tenants SET status = 'deleted', deleted_at = NOW() WHERE id = %s",
            (tenant_id,)
        )
        
        # Schedule hard delete after retention period
        schedule_deletion.apply_async(
            args=[tenant_id],
            countdown=86400 * 30  # 30 days
        )
    
    async def hard_delete(self, tenant_id: str):
        # Drop schema/database
        await db.execute(f"DROP SCHEMA {tenant_id} CASCADE")
        
        # Delete vector store collection
        chroma_client.delete_collection(f"tenant_{tenant_id}")
        
        # Delete backups
        await self.delete_backups(tenant_id)
        
        # Remove from tenants table
        await db.execute("DELETE FROM tenants WHERE id = %s", (tenant_id,))
```

---

## Quick Reference

| Action | Steps |
|--------|-------|
| **Provision** | DB + Vector + Config + Activate |
| **Suspend** | Update status, disable access |
| **Delete** | Soft delete → 30 days → Hard delete |
