| **Subtopic** | **Focus** | **Key Concepts** | **One-Line Recall** |
|---|---|---|---|
| **LC12.4.1** | What to log | User actions, data access, changes | Log all security-relevant events. |
| **LC12.4.2** | Storage | Immutable append-only logs | Never delete or modify audit logs. |
| **LC12.4.3** | Format | Structured JSON logs | Machine-readable format. |
| **LC12.4.4** | Retention | Compliance-driven duration | Keep logs per regulatory requirements. |
| **LC12.4.5** | Search | Query and analyze logs | Enable investigation and reporting. |

# Audit Logging

```python
import structlog

audit_logger = structlog.get_logger("audit")

class AuditLog:
    def record(self, event_type: str, user_id: str, resource: str, details: dict):
        audit_logger.info("audit_event",
            event_type=event_type,
            user_id=user_id,
            tenant_id=g.tenant_id,
            resource=resource,
            details=details,
            timestamp=datetime.utcnow().isoformat(),
            ip_address=request.remote_addr
        )

# Usage
@app.post("/conversations/{conv_id}/messages")
async def add_message(conv_id: str, message: str):
    result = conversation_service.add_message(conv_id, message)
    
    audit_log.record(
        event_type="message_created",
        user_id=g.user_id,
        resource=f"conversation:{conv_id}",
        details={"message_length": len(message)}
    )
    
    return result
```

**Quick Ref:** Log who, what, when, where for all actions; immutable storage; enable search.
