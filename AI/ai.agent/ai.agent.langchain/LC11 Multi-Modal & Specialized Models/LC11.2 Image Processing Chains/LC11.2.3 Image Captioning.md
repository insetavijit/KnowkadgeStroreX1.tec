| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC11.2.3.1 Basic Captioning**                | Simple description                      | Prompt VLM to describe image contents                                         | Ask "Describe this image" for basic captions.                   |
| **LC11.2.3.2 Detailed Descriptions**           | Rich output                             | Multi-sentence descriptions with context                                      | Request detailed descriptions for richer output.                |
| **LC11.2.3.3 Caption Styles**                  | Format control                          | Short, long, technical, casual styles                                         | Control caption length and style via prompts.                   |
| **LC11.2.3.4 Accessibility Captions**          | Alt text                                | Writing screen-reader friendly descriptions                                   | Generate alt text for accessibility.                            |
| **LC11.2.3.5 Caption Chains**                  | LCEL pattern                            | Building reusable captioning pipelines                                        | Build captioning chains with LCEL.                              |

# Image Captioning: Describing Visual Content

Generating text descriptions from images is one of the most common VLM tasks.

---

## 1. Basic Captioning

```python
from langchain_openai import ChatOpenAI
from langchain_core.messages import HumanMessage

llm = ChatOpenAI(model="gpt-4o")

def caption_image(image_url: str) -> str:
    message = HumanMessage(
        content=[
            {"type": "text", "text": "Describe this image in one sentence."},
            {"type": "image_url", "image_url": {"url": image_url}}
        ]
    )
    return llm.invoke([message]).content
```

**Output**: "A golden retriever puppy playing fetch in a sunny park."

---

## 2. Detailed Descriptions

For richer context:

```python
prompt = """
Describe this image in detail. Include:
1. Main subject and their actions
2. Background and setting
3. Colors and lighting
4. Mood and atmosphere
"""
```

**Output** (longer, more detailed):
"The image shows a young woman reading a book at a sunlit caf√©. She sits at a wooden table by a large window, wearing a blue sweater. The afternoon light casts warm shadows across the pages..."

---

## 3. Caption Styles

| Style | Prompt Snippet | Use Case |
|-------|----------------|----------|
| **Terse** | "One sentence only" | Thumbnails |
| **Detailed** | "3-4 sentences with context" | Blog posts |
| **Technical** | "Include dimensions, colors, objects" | Inventory |
| **Casual** | "Describe like telling a friend" | Social media |
| **Alt Text** | "Write accessible image description" | Web accessibility |

---

## 4. Accessibility Alt Text

For screen readers:

```python
prompt = """
Write an alt text description for this image.
- Be concise (under 125 characters ideally)
- Focus on essential information
- Don't start with "Image of" or "Picture of"
- Describe what's important for understanding context
"""
```

**Output**: "Chef preparing sushi rolls at a restaurant counter"

---

## 5. Caption Chain (LCEL)

```python
from langchain_core.runnables import RunnableLambda
from langchain_core.output_parsers import StrOutputParser

def build_caption_message(inputs: dict):
    style = inputs.get("style", "one sentence")
    return [HumanMessage(content=[
        {"type": "text", "text": f"Caption this image in {style}."},
        {"type": "image_url", "image_url": {"url": inputs["image_url"]}}
    ])]

caption_chain = (
    RunnableLambda(build_caption_message)
    | llm
    | StrOutputParser()
)

# Usage
caption = caption_chain.invoke({
    "image_url": "https://example.com/photo.jpg",
    "style": "3 detailed sentences"
})
```

---

## Quick Reference

| Task | Prompt Approach |
|------|-----------------|
| **Quick Caption** | "One sentence" |
| **Detailed** | "Multiple paragraphs with context" |
| **Alt Text** | "Accessible, concise" |
| **Batch** | Use `.batch()` for multiple images |
