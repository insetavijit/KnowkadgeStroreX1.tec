| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC11.2.2.1 Base64 Encoding**                 | Standard method                         | Converting binary image to base64 string                                      | Base64 encodes binary as text for transport.                    |
| **LC11.2.2.2 Data URI Construction**           | API format                              | Building data:image/type;base64,DATA strings                                  | Data URIs embed image in the message.                           |
| **LC11.2.2.3 Format Conversion**               | Optimization                            | Converting between JPEG, PNG, WebP                                            | Convert to JPEG for smaller size.                               |
| **LC11.2.2.4 Quality vs Size**                 | Trade-off                               | Balancing image quality with file size                                        | JPEG quality 85 is good balance.                                |
| **LC11.2.2.5 Encoding Functions**              | Utilities                               | Reusable encoding helper functions                                            | Build utility functions for image encoding.                     |

# Image Encoding: Preparing Images for APIs

VLM APIs need images in specific formatsâ€”usually Base64 data URIs.

---

## 1. Base64 Encoding Basics

Base64 converts binary data to ASCII text.

```python
import base64

# Encoding
with open("image.jpg", "rb") as f:
    encoded = base64.b64encode(f.read()).decode("utf-8")

# Decoding
decoded = base64.b64decode(encoded)
```

**Why Base64?**: JSON APIs can't handle raw binary. Base64 makes images "text-safe".

---

## 2. Data URI Construction

VLMs expect this format:
```
data:image/<type>;base64,<encoded_data>
```

```python
def to_data_uri(image_bytes: bytes, mime_type: str) -> str:
    """Convert image bytes to data URI."""
    encoded = base64.b64encode(image_bytes).decode()
    return f"data:{mime_type};base64,{encoded}"

# Usage
with open("photo.png", "rb") as f:
    data_uri = to_data_uri(f.read(), "image/png")
```

---

## 3. Format Conversion

Convert to efficient format before encoding:

```python
from PIL import Image
import io

def convert_to_jpeg(image_path: str, quality: int = 85) -> bytes:
    """Convert any image to JPEG for smaller size."""
    img = Image.open(image_path)
    
    # Convert RGBA to RGB (JPEG doesn't support alpha)
    if img.mode == "RGBA":
        img = img.convert("RGB")
    
    buffer = io.BytesIO()
    img.save(buffer, format="JPEG", quality=quality)
    return buffer.getvalue()
```

---

## 4. Quality vs Size Trade-off

| JPEG Quality | File Size | Visual Quality |
|--------------|-----------|----------------|
| **95** | Large | Excellent |
| **85** | Medium | Very Good |
| **75** | Small | Good |
| **50** | Very Small | Acceptable |

**Recommendation**: Use quality 85 for most use cases.

---

## 5. Complete Encoding Utility

```python
from PIL import Image
import io
import base64
from pathlib import Path

def encode_image_for_api(
    source: str | Path,
    max_size: int = 1024,
    quality: int = 85
) -> str:
    """
    Load, resize, and encode image for VLM API.
    Returns data URI ready for HumanMessage content.
    """
    # Load image
    img = Image.open(source)
    
    # Resize if too large
    img.thumbnail((max_size, max_size))
    
    # Convert to RGB if needed
    if img.mode in ("RGBA", "P"):
        img = img.convert("RGB")
    
    # Save to buffer
    buffer = io.BytesIO()
    img.save(buffer, format="JPEG", quality=quality)
    
    # Encode
    encoded = base64.b64encode(buffer.getvalue()).decode()
    return f"data:image/jpeg;base64,{encoded}"
```

---

## Quick Reference

| Step | Function |
|------|----------|
| **Load** | `Image.open()` |
| **Resize** | `img.thumbnail()` |
| **Convert** | `img.convert("RGB")` |
| **Save** | `img.save(buffer, ...)` |
| **Encode** | `base64.b64encode()` |
