| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC11.7.5.1 Codebase Indexing**               | Search                                  | Indexing code for semantic search                                             | Index code for natural language search.                         |
| **LC11.7.5.2 Architecture Understanding**      | Structure                               | Understanding project structure                                               | LLMs can understand project architecture.                       |
| **LC11.7.5.3 Cross-File Analysis**             | Relationships                           | Understanding dependencies across files                                       | Trace function calls across files.                              |
| **LC11.7.5.4 Large Codebase Strategies**       | Scale                                   | Handling repos with 1000s of files                                            | Chunk and summarize for large codebases.                        |
| **LC11.7.5.5 Code Search**                     | Discovery                               | Finding relevant code by description                                          | "Find where we handle authentication."                          |

# Repository Analysis: Understanding Large Codebases

LLMs help navigate and understand entire projects.

---

## 1. Codebase Indexing

Index code for semantic search:

```python
from langchain_openai import OpenAIEmbeddings
from langchain_chroma import Chroma
from langchain_community.document_loaders import DirectoryLoader
from langchain.text_splitter import RecursiveCharacterTextSplitter

def index_repository(repo_path: str):
    """Index a repository for semantic code search."""
    
    # Load code files
    loader = DirectoryLoader(
        repo_path,
        glob="**/*.py",
        show_progress=True
    )
    docs = loader.load()
    
    # Split into chunks
    splitter = RecursiveCharacterTextSplitter.from_language(
        language="python",
        chunk_size=1000,
        chunk_overlap=100
    )
    chunks = splitter.split_documents(docs)
    
    # Index
    vectorstore = Chroma.from_documents(
        documents=chunks,
        embedding=OpenAIEmbeddings(),
        persist_directory="./code_index"
    )
    
    return vectorstore
```

---

## 2. Architecture Understanding

```python
architecture_prompt = ChatPromptTemplate.from_template("""
Analyze this project structure and key files:

Directory structure:
```
{directory_tree}
```

Sample files:
{sample_files}

Explain:
1. Overall architecture pattern (MVC, microservices, etc.)
2. Main components and their purposes
3. Data flow through the system
4. Key entry points
5. Dependencies between components
""")
```

---

## 3. Cross-File Analysis

```python
cross_file_prompt = ChatPromptTemplate.from_template("""
Trace this function's usage across the codebase:

Function: {function_name}
Defined in: {source_file}

Files referencing it:
{referencing_files}

Explain:
1. Where is this function called from?
2. What are the typical inputs it receives?
3. What depends on its output?
4. Impact if modified?
""")

# Helper to find references
def find_function_references(repo_path: str, function_name: str) -> list:
    """Find all files that use a function."""
    import subprocess
    result = subprocess.run(
        ["grep", "-r", "-l", function_name, repo_path, "--include=*.py"],
        capture_output=True, text=True
    )
    return result.stdout.strip().split('\n')
```

---

## 4. Large Codebase Strategies

For repos with 1000+ files:

```python
class LargeRepoAnalyzer:
    def __init__(self, repo_path: str):
        self.repo_path = repo_path
        self.summaries = {}
    
    def analyze_hierarchically(self):
        """Summarize bottom-up."""
        
        # Level 1: Summarize each file
        for file_path in get_all_files(self.repo_path):
            self.summaries[file_path] = self.summarize_file(file_path)
        
        # Level 2: Summarize each directory
        for dir_path in get_all_dirs(self.repo_path):
            file_summaries = [
                self.summaries[f] for f in get_files_in_dir(dir_path)
            ]
            self.summaries[dir_path] = self.summarize_directory(file_summaries)
        
        # Level 3: Full repo summary
        top_summaries = [self.summaries[d] for d in get_top_dirs(self.repo_path)]
        return self.create_repo_summary(top_summaries)
    
    def summarize_file(self, path: str) -> str:
        """One-paragraph file summary."""
        code = read_file(path)
        return file_summary_chain.invoke({"code": code, "path": path})
    
    def query(self, question: str) -> str:
        """Answer questions using hierarchical summaries."""
        # RAG over summaries
        relevant = self.vectorstore.similarity_search(question)
        return qa_chain.invoke({"context": relevant, "question": question})
```

---

## 5. Semantic Code Search

```python
class CodeSearch:
    def __init__(self, repo_vectorstore):
        self.store = repo_vectorstore
    
    def search(self, query: str, k: int = 10) -> list:
        """Find code matching natural language query."""
        results = self.store.similarity_search(query, k=k)
        return [
            {
                "file": doc.metadata["source"],
                "code": doc.page_content,
                "relevance": doc.metadata.get("score", None)
            }
            for doc in results
        ]

# Usage
search = CodeSearch(repo_vectorstore)
results = search.search("where we validate user input")
```

---

## Quick Reference

| Task | Approach |
|------|----------|
| **Index** | Chunk + embed code files |
| **Architecture** | Summarize structure |
| **Cross-file** | grep + LLM analysis |
| **Large repos** | Hierarchical summarization |
| **Search** | Semantic similarity |
