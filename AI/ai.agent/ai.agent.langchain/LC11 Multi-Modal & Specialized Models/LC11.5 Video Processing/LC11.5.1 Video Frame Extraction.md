| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC11.5.1.1 Frame Extraction Basics**         | Fundamentals                            | Using OpenCV/FFmpeg to extract frames                                         | OpenCV and FFmpeg extract frames from video.                    |
| **LC11.5.1.2 Sampling Strategies**             | Selection                               | Every Nth frame, scene detection, keyframes                                   | Sample intelligently to reduce processing.                      |
| **LC11.5.1.3 Keyframe Extraction**             | Important frames                        | Detecting scene changes and key moments                                       | Keyframes capture important video moments.                      |
| **LC11.5.1.4 Frame Quality**                   | Resolution                              | Resolution, format, compression settings                                      | Balance quality vs file size in frames.                         |
| **LC11.5.1.5 Batch Frame Processing**          | Scale                                   | Efficiently extracting frames from many videos                                | Batch process frames for large video sets.                      |

# Video Frame Extraction: Slicing Video into Images

Most VLMs don't understand video directlyâ€”they see frames.

---

## 1. Frame Extraction with OpenCV

```python
import cv2
from pathlib import Path

def extract_frames(video_path: str, output_dir: str = None, 
                   sample_rate: int = 30) -> list[str]:
    """
    Extract frames from video.
    sample_rate: Extract every Nth frame (30 = ~1 fps for 30fps video)
    """
    cap = cv2.VideoCapture(video_path)
    
    if output_dir:
        Path(output_dir).mkdir(exist_ok=True)
    
    frames = []
    frame_count = 0
    
    while cap.isOpened():
        ret, frame = cap.read()
        if not ret:
            break
        
        if frame_count % sample_rate == 0:
            if output_dir:
                path = f"{output_dir}/frame_{frame_count:06d}.jpg"
                cv2.imwrite(path, frame)
                frames.append(path)
            else:
                frames.append(frame)  # Return numpy arrays
        
        frame_count += 1
    
    cap.release()
    return frames
```

---

## 2. Sampling Strategies

| Strategy | When to Use | Code |
|----------|-------------|------|
| **Fixed Rate** | General purpose | Every 30th frame |
| **Time-Based** | Specific intervals | Every 5 seconds |
| **Scene Change** | Narrative videos | PySceneDetect |
| **Motion-Based** | Action detection | Frame diff threshold |

**Time-Based Extraction**:
```python
def extract_at_intervals(video_path: str, interval_sec: float = 5.0):
    cap = cv2.VideoCapture(video_path)
    fps = cap.get(cv2.CAP_PROP_FPS)
    frame_interval = int(fps * interval_sec)
    
    # Extract every interval_sec seconds
    return extract_frames(video_path, sample_rate=frame_interval)
```

---

## 3. Scene Change Detection

Using PySceneDetect for intelligent extraction:

```bash
pip install scenedetect[opencv]
```

```python
from scenedetect import detect, ContentDetector

def extract_scene_frames(video_path: str) -> list[tuple]:
    """Extract frame at each scene change."""
    scenes = detect(video_path, ContentDetector())
    
    cap = cv2.VideoCapture(video_path)
    frames = []
    
    for scene in scenes:
        start_frame = scene[0].get_frames()
        cap.set(cv2.CAP_PROP_POS_FRAMES, start_frame)
        ret, frame = cap.read()
        if ret:
            frames.append((start_frame, frame))
    
    cap.release()
    return frames
```

---

## 4. Frame Quality Settings

```python
def extract_high_quality(video_path: str, max_dimension: int = 1920):
    cap = cv2.VideoCapture(video_path)
    
    while cap.isOpened():
        ret, frame = cap.read()
        if not ret:
            break
        
        # Resize if too large
        h, w = frame.shape[:2]
        if max(h, w) > max_dimension:
            scale = max_dimension / max(h, w)
            frame = cv2.resize(frame, None, fx=scale, fy=scale)
        
        # Save with quality setting
        cv2.imwrite(
            "frame.jpg", 
            frame, 
            [cv2.IMWRITE_JPEG_QUALITY, 90]  # 0-100
        )
```

---

## 5. FFmpeg Alternative (Faster)

For large videos, FFmpeg is faster:

```python
import subprocess

def ffmpeg_extract(video_path: str, output_pattern: str, fps: float = 1.0):
    """Extract frames using FFmpeg (faster than OpenCV)."""
    cmd = [
        "ffmpeg", "-i", video_path,
        "-vf", f"fps={fps}",  # 1 frame per second
        "-q:v", "2",  # Quality (2 = high)
        output_pattern  # "frames/frame_%04d.jpg"
    ]
    subprocess.run(cmd, check=True)
```

---

## Quick Reference

| Tool | Speed | Features |
|------|-------|----------|
| **OpenCV** | Medium | Flexible, programmatic |
| **FFmpeg** | Fast | CLI, batch processing |
| **PySceneDetect** | Slow | Intelligent scene detection |
