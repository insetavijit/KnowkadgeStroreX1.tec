| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC11.5.3.1 Before/After Analysis**           | Change detection                        | Comparing states at different times                                           | Compare frames to detect changes over time.                     |
| **LC11.5.3.2 Event Detection**                 | Moments                                 | Identifying when specific events occur                                        | Detect when key events happen in video.                         |
| **LC11.5.3.3 Sequence Understanding**          | Flow                                    | Understanding order and causality                                             | Understand cause-and-effect in frame sequences.                 |
| **LC11.5.3.4 Duration and Timing**             | Measurement                             | Estimating how long events take                                               | Estimate duration from frame timestamps.                        |
| **LC11.5.3.5 Temporal Reasoning**              | Inference                               | Answering time-based questions                                                | Answer "when", "how long", "what order" questions.              |

# Temporal Analysis: Understanding Time in Video

Video uniquely captures change over time.

---

## 1. Before/After Analysis

Compare states at different points:

```python
def compare_frames(before_path: str, after_path: str, question: str) -> str:
    content = [
        {"type": "text", "text": "Compare these two frames from the same video."},
        {"type": "text", "text": "BEFORE:"},
        {"type": "image_url", "image_url": {"url": encode(before_path)}},
        {"type": "text", "text": "AFTER:"},
        {"type": "image_url", "image_url": {"url": encode(after_path)}},
        {"type": "text", "text": f"Question: {question}"}
    ]
    
    return llm.invoke([HumanMessage(content=content)]).content

# Usage
changes = compare_frames(
    frame_0, 
    frame_100, 
    "What changed between these frames?"
)
```

---

## 2. Event Detection

Find when specific events occur:

```python
def detect_event(frames_with_timestamps: list[tuple], event_description: str):
    """Find when an event occurs in video frames."""
    
    prompt = f"""
Analyze these video frames to detect: "{event_description}"

For each frame, indicate:
- Is the event occurring? (yes/no)
- Confidence (0-100%)
- Description of what you see

Frames:
"""
    
    content = [{"type": "text", "text": prompt}]
    
    for timestamp, frame_path in frames_with_timestamps:
        content.append({
            "type": "text", 
            "text": f"[{timestamp:.1f}s]"
        })
        content.append({
            "type": "image_url",
            "image_url": {"url": encode(frame_path)}
        })
    
    return llm.invoke([HumanMessage(content=content)]).content

# Find when person enters room
detect_event(frames, "person entering through door")
```

---

## 3. Sequence Understanding

Understand cause and effect:

```python
sequence_prompt = """
These frames show a sequence of events. Analyze:

1. What happens first?
2. What causes the subsequent events?
3. What is the logical order of actions?
4. Is anything happening simultaneously?

Describe the sequence as a timeline.
"""
```

---

## 4. Duration Estimation

Estimate time from frames:

```python
def estimate_duration(video_path: str, frames: list, event: str) -> dict:
    """Estimate how long an event takes."""
    
    cap = cv2.VideoCapture(video_path)
    fps = cap.get(cv2.CAP_PROP_FPS)
    cap.release()
    
    # Get frame numbers where event occurs
    event_frames = detect_event_frames(frames, event)
    
    if event_frames:
        start_frame = min(event_frames)
        end_frame = max(event_frames)
        duration_sec = (end_frame - start_frame) / fps
        
        return {
            "start_time": start_frame / fps,
            "end_time": end_frame / fps,
            "duration": duration_sec
        }
    
    return None
```

---

## 5. Temporal Reasoning Questions

Types of temporal questions VLMs can answer:

| Question Type | Example | Approach |
|---------------|---------|----------|
| **When** | "When does the car appear?" | Scan frames, find first occurrence |
| **How long** | "How long does he speak?" | Find start/end, calculate duration |
| **Order** | "Did A happen before B?" | Analyze sequence order |
| **Frequency** | "How many times did she wave?" | Count occurrences across frames |
| **Simultaneity** | "What was happening while...?" | Analyze concurrent events |

```python
temporal_qa_prompt = """
Video frames are shown with timestamps.

Question: {question}

Analyze the frames temporally to answer. 
Include specific timestamps in your answer.
"""
```

---

## Quick Reference

| Analysis | Method |
|----------|--------|
| **Change Detection** | Compare before/after |
| **Event Finding** | Scan frames with description |
| **Ordering** | Sequence analysis |
| **Duration** | Frame count Ã— (1/fps) |
