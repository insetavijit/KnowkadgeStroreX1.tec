| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC11.3.6.1 Document Image Understanding**    | Context                                 | VLMs analyzing scanned documents                                              | VLMs can read and understand document images.                   |
| **LC11.3.6.2 Form Field Extraction**           | Data extraction                         | Extracting key-value pairs from forms                                         | Extract form fields as structured data.                         |
| **LC11.3.6.3 Invoice/Receipt Processing**      | Finance                                 | Extracting financial data from documents                                      | VLMs excel at invoice and receipt extraction.                   |
| **LC11.3.6.4 Multi-Page Documents**            | Pagination                              | Handling documents spanning multiple pages                                    | Process multi-page docs page by page.                           |
| **LC11.3.6.5 Specialized Document VQA**        | Domain-specific                         | Legal, medical, technical document QA                                         | Fine-tune prompts for domain-specific documents.                |

# Document VQA: Questions About Document Images

Answering questions about scanned documents, forms, and receipts.

---

## 1. Document Image Understanding

VLMs can understand document layouts:

```python
message = HumanMessage(content=[
    {"type": "image_url", "image_url": {"url": document_image_url}},
    {"type": "text", "text": "What type of document is this? Summarize its contents."}
])

response = llm.invoke([message])
# "This is an employment agreement dated March 15, 2024, between..."
```

VLMs understand:
*   Headers, footers, page numbers
*   Tables and forms
*   Signatures and stamps
*   Multi-column layouts

---

## 2. Form Field Extraction

```python
from pydantic import BaseModel

class FormData(BaseModel):
    name: str
    date: str
    address: str
    signature_present: bool

parser = PydanticOutputParser(pydantic_object=FormData)

prompt = f"""
Extract the following fields from this form:
{parser.get_format_instructions()}
"""

# Returns structured form data
```

---

## 3. Invoice/Receipt Processing

Highly practical use case:

```python
class InvoiceData(BaseModel):
    vendor_name: str
    invoice_number: str
    date: str
    line_items: list[dict]
    subtotal: float
    tax: float
    total: float

prompt = """
Extract all invoice details from this image.
Be precise with monetary values.
If a field is unclear, mark it as "unclear".
"""

# Process invoice image
invoice_chain.invoke({"image_url": invoice_url})
```

---

## 4. Multi-Page Documents

For documents with multiple pages:

```python
async def process_multipage_document(page_images: list[str], question: str) -> str:
    """Process multi-page document and answer question."""
    
    # Option 1: Process all pages together (if within context limit)
    if len(page_images) <= 5:
        content = [{"type": "text", "text": f"This document has {len(page_images)} pages."}]
        for i, img in enumerate(page_images):
            content.append({"type": "text", "text": f"Page {i+1}:"})
            content.append({"type": "image_url", "image_url": {"url": img}})
        content.append({"type": "text", "text": f"Question: {question}"})
        
        return llm.invoke([HumanMessage(content=content)]).content
    
    # Option 2: Process pages individually, then synthesize
    page_summaries = []
    for i, img in enumerate(page_images):
        summary = await summarize_page(img, i+1)
        page_summaries.append(summary)
    
    # Synthesize answer from summaries
    return await synthesize_answer(page_summaries, question)
```

---

## 5. Domain-Specific Document VQA

**Legal Documents**:
```python
prompt = """
Analyze this legal document.
Identify:
- Document type (contract, agreement, filing)
- Key parties involved
- Important dates and deadlines
- Key obligations and terms
"""
```

**Medical Records**:
```python
prompt = """
Extract medical information (be careful with PHI):
- Patient demographics (redact SSN/DOB)
- Diagnoses
- Medications
- Treatment plans
"""
```

**Technical Diagrams**:
```python
prompt = """
Analyze this technical diagram:
- Main components and their relationships
- Data flow direction
- Key connections and dependencies
"""
```

---

## Quick Reference

| Document Type | Key Extraction Points |
|---------------|----------------------|
| **Forms** | Field names â†’ values |
| **Invoices** | Line items, totals |
| **Contracts** | Parties, dates, terms |
| **Medical** | Diagnoses, medications |
| **Technical** | Components, flows |
