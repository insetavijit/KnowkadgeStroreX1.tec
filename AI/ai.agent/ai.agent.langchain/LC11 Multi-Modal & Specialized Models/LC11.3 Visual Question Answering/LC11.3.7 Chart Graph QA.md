| **Subtopic**                                   | **Focus & Purpose**                     | **Key Concepts / Details**                                                    | **One-Line Recall**                                             |
| ---------------------------------------------- | --------------------------------------- | ----------------------------------------------------------------------------- | --------------------------------------------------------------- |
| **LC11.3.7.1 Chart Understanding**             | Reading charts                          | VLMs interpreting bar, line, pie charts                                       | VLMs can read and interpret common chart types.                 |
| **LC11.3.7.2 Data Extraction**                 | Numbers                                 | Extracting numerical values from visualizations                               | Extract exact values from charts.                               |
| **LC11.3.7.3 Trend Analysis**                  | Patterns                                | Identifying trends, peaks, anomalies                                          | VLMs can describe trends and patterns.                          |
| **LC11.3.7.4 Graph Types**                     | Variety                                 | Bar, line, pie, scatter, heatmaps                                             | Different charts need different prompting.                      |
| **LC11.3.7.5 Chart-to-Table Conversion**       | Structured output                       | Converting visual charts to tabular data                                      | Convert charts back to data tables.                             |

# Chart/Graph QA: Understanding Data Visualizations

VLMs can read charts and answer questions about data.

---

## 1. Chart Understanding

VLMs can interpret common visualizations:

```python
message = HumanMessage(content=[
    {"type": "image_url", "image_url": {"url": chart_url}},
    {"type": "text", "text": "What does this chart show? Summarize the key insights."}
])

response = llm.invoke([message])
# "This bar chart shows quarterly revenue from 2022-2024. Q4 2023 shows the highest 
#  revenue at $4.2M, while Q1 2022 was lowest at $2.1M. There's a clear upward trend..."
```

---

## 2. Data Extraction

Get specific numbers:

```python
prompt = """
From this chart, extract:
1. The exact value for "Marketing" category
2. The highest value and its label
3. The lowest value and its label
4. The average of all values shown
"""

# VLM reads the visualization and returns numbers
```

**Tip**: For precise extraction, ask for specific values rather than general descriptions.

---

## 3. Trend Analysis

```python
prompt = """
Analyze this line chart:
1. What is the overall trend (increasing, decreasing, stable)?
2. Are there any notable peaks or dips? When do they occur?
3. Are there any seasonal patterns?
4. If the trend continues, what would you predict for the next period?
"""
```

**Output Example**:
```
1. Overall trend is increasing with ~15% YoY growth
2. Notable dip in March 2023, peak in December 2023
3. Clear seasonal pattern with Q4 being strongest
4. Projected next Q1: approximately $3.8M based on pattern
```

---

## 4. Chart Type Handling

| Chart Type | Best Prompts |
|------------|--------------|
| **Bar Chart** | "Compare categories", "Which is highest/lowest" |
| **Line Chart** | "Describe trend", "When did X occur" |
| **Pie Chart** | "What percentage", "Largest segment" |
| **Scatter Plot** | "Any correlation", "Outliers" |
| **Heatmap** | "Hotspots", "Patterns by row/column" |

---

## 5. Chart-to-Table Conversion

Convert visual back to data:

```python
from pydantic import BaseModel

class ChartData(BaseModel):
    title: str
    x_axis_label: str
    y_axis_label: str
    data_points: list[dict]  # [{"label": "Q1", "value": 100}, ...]

prompt = f"""
Convert this chart to structured data.
Extract all visible data points.
{parser.get_format_instructions()}
"""

# Returns
{
    "title": "Quarterly Revenue 2024",
    "x_axis_label": "Quarter",
    "y_axis_label": "Revenue ($ millions)",
    "data_points": [
        {"label": "Q1", "value": 2.1},
        {"label": "Q2", "value": 2.8},
        {"label": "Q3", "value": 3.2},
        {"label": "Q4", "value": 4.2}
    ]
}
```

---

## LCEL Chart QA Chain

```python
class ChartQA:
    def __init__(self, llm):
        self.llm = llm
    
    def ask(self, chart_url: str, question: str) -> str:
        message = HumanMessage(content=[
            {"type": "image_url", "image_url": {"url": chart_url}},
            {"type": "text", "text": f"""
Analyze this chart carefully and answer the question.
Be precise with any numbers you report.

Question: {question}
"""}
        ])
        return self.llm.invoke([message]).content

# Usage
chart_qa = ChartQA(llm)
answer = chart_qa.ask(chart_url, "What was the revenue in Q3?")
```

---

## Quick Reference

| Task | Approach |
|------|----------|
| **Summary** | "What does this chart show?" |
| **Specific Value** | "What is the value for X?" |
| **Comparison** | "Which is higher, A or B?" |
| **Trend** | "What is the overall trend?" |
| **To Table** | Use Pydantic for structured output |
